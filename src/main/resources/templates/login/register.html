<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>注册页面</title>
    <link th:href="@{/css/bootstrap.css}" rel="stylesheet"/>
    <link th:href="@{/layui/css/layui.css}" rel="stylesheet">
    <link th:href="@{/css/login.css}" rel="stylesheet"/>
    <style>
        .leaderLogin {
            width: 430px;
        }

        .leaderLogin {
            margin-top: 30px;
        }

        .content .row {
            margin-bottom: 7px;
        }

        .layui-form-select dl dd.layui-this {
            background-color: #85c1ff;
        }

        .layui-form-radio:hover *, .layui-form-radioed, .layui-form-radioed > i {
            color: #85c1ff;
        }
    </style>
</head>
<body>
<div>
    <div class="leaderLogin">
        <form action="" class="content layui-form" id="formDemo">
            <div class="row">
                <div style="color: #85c1ff;font-size: 22px;font-weight: bold;text-align: center;float: left;margin-left: 150px;">
                    注册页面
                </div>
                <div style="float:right;margin-right: 25px;font-size: 14px;">
                    <a href="/login" style="color: #9e9a9a">登录</a>
                </div>
            </div>
            <div class="row layui-form-item">
                <div class="col-xs-12">
                    <select name="role" id="role" class="form-control" style="height: 40px;line-height: 40px"
                            lay-verify="role" lay-filter="role">
                        <option value="">请选择要注册的角色</option>
                        <option value="0" selected>用户</option>
                        <option value="1">审稿人</option>
                        <option value="2">会议发布者</option>
                    </select>
                </div>
            </div>
            <!--  选择用户对应显示的区域-->
            <div style="display:none" class="div" id="div0">
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="text" id="username" class="layui-input" name="username" placeholder="请输入用户名"
                               lay-verify="username"
                               style="background-image: url('/images/login/username.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="password" id="password" class="layui-input" name="password" placeholder="请输入密码"
                               lay-verify="password"
                               style="background-image: url('/images/login/password.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="password" id="qrpassword" class="layui-input" name="qrpassword" placeholder="请确认密码"
                               lay-verify="qrpassword"
                               style="background-image: url('/images/login/qrpassword.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="text" id="name" class="layui-input" name="name" placeholder="请输入姓名" lay-verify="name"
                               style="background-image: url('/images/login/name.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="email" id="email" class="layui-input" name="email" placeholder="请输入电子邮箱" lay-verify="email"
                               style="background-image: url('/images/login/email.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12" style="margin-top: -17px; margin-bottom: -3px">
                        <input type="radio" name="sex" value="0" title="男" checked>
                        <input type="radio" name="sex" value="1" title="女">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="text" class="layui-input" id="birthday" name="birthday" placeholder="请选择出生年月">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="text" id="education" class="layui-input" name="education" placeholder="请输入教育程度"
                               lay-verify="education"
                               style="background-image: url('/images/login/education.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="text" id="institution" class="layui-input" name="institution" placeholder="请输入所在机构"
                               lay-verify="institution"
                               style="background-image: url('/images/login/institution.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="text" id="city" class="layui-input" name="city" placeholder="请输入所在城市"
                               lay-verify="city"
                               style="background-image: url('/images/login/city.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
            </div>
            <!-- 选择审稿人和会议发布者对应显示的区域-->
            <div style="display:none" class="div" id="div1">
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="text" id="username2" class="layui-input" name="username2" placeholder="请输入用户名"
                               lay-verify="username2"
                               style="background-image: url('/images/login/username.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="password" id="password2" class="layui-input" name="password2" placeholder="请输入密码"
                               lay-verify="password2"
                               style="background-image: url('/images/login/password.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="password" id="qrpassword2" class="layui-input" name="qrpassword2"
                               placeholder="请确认密码" lay-verify="qrpassword2"
                               style="background-image: url('/images/login/qrpassword.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="text" id="name2" class="layui-input" name="name2" placeholder="请输入姓名" lay-verify="name2"
                               style="background-image: url('/images/login/name.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
                <div class="row layui-form-item">
                    <div class="col-xs-12">
                        <input type="email" id="email2" class="layui-input" name="email2" placeholder="请输入电子邮箱" lay-verify="email2"
                               style="background-image: url('/images/login/email.png'); background-repeat: no-repeat; padding:0 40px 0 40px;  background-position: 10px 10px;">
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-xs-12">
                    <button type="submit" class="layui-btn" id="registerBtn" lay-submit="" lay-filter="registerForm">
                        注册
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
<script th:src="@{/js/jquery-1.11.3.min.js}"></script>
<script th:src="@{/js/bootstrap.js}"></script>
<script th:src="@{/layui/layui.js}"></script>
<script>
    layui.use(['layer', 'jquery', 'form', 'laydate'], function () {
        var layer = layui.layer,
            $ = layui.jquery,
            form = layui.form;
        laydate = layui.laydate;

        //执行一个laydate实例
        laydate.render({
            elem: '#birthday' //指定元素
        });
        //下拉框显示的初始化
        // console.log(role.value)
        ShowDiv(role.value)
        // 下拉框改变时触发
        form.on('select(role)', function (data) {
            // console.log('1111')
            ShowDiv(data.value); //显示对应的div
            form.render('select'); // 渲染select,固定写法
        });

        //用户名组合 2-10个字符
        var urnamePattern = /^[a-zA-Z0-9]{2,10}$/
        //密码组合 最少6位，最多12位字母或数字的组合
        var pwdPattern = /^[a-zA-Z0-9]{6,12}$/;
         // * \w{3,}:任意字母或数字至少3个
    //     * (\.\w+)*:.加任意字符或数字至少一个，整体可有可无,0或多个
    //     * @：一定要有@
    // * [A-z0-9]+:任意字母或数字至少1个
    //     * (\.[A-z]{2,5}){1,2}: .加任意字符2到5个，整体1到2个
    //     */
        //邮箱正则
        var emailPattern = /^\w{3,}(\.\w+)*@[A-z0-9]+(\.[A-z]{2,5}){1,2}$/;
        // 表单验证
        form.verify({
            role: function (value) {
                if (value.length == 0) {
                    return '请选择一个角色';
                }
            },
            username: function (value) {
                // 判断当前选中的角色 为用户则验证
                if ($('#role').val() == '0') {
                    if (value.length == 0) {
                        return '用户名不能为空';
                    }
                    if (!urnamePattern.test(value)) {
                        return '用户名需为2-10个字符';
                    }
                }
            },
            password: function (value) {
                // 判断当前选中的角色 为用户则验证
                if ($('#role').val() == '0') {
                    if (value.length == 0) {
                        return '密码不能为空';
                    }
                    if (!pwdPattern.test(value)) {
                        return '密码需为6-12个字符';
                    }
                }
            },
            qrpassword: function (value) {
                // 判断当前选中的角色 为用户则验证
                if ($('#role').val() == '0') {
                    if (value != $('#password').val()) {
                        return '两次密码要保持一致';
                    }
                }
            },
            // name:function (value){
            //     // 判断当前选中的角色 为用户则验证
            //     if ($('#role').val() == '0') {
            //         // 保证名字不为空的时候，长度要在2-4之间
            //         if(value.length!=0 && (value.length<2 || value.length>4)){
            //             return '名字长度要在2-4之间';
            //         }
            //     }
            // },
            email:function (value){
                // 判断当前选中的角色 为用户则验证
                if ($('#role').val() == '0') {
                    // 保证邮箱不为空的时候，要满足邮箱的正则表达式
                    if(value.length!=0 && !emailPattern.test(value)){
                        return '请输入一个合法的邮箱';
                    }
                }
            },
            username2: function (value) {
                // 判断当前选中的角色 不为用户则验证
                if ($('#role').val() != '0') {
                    if (value.length == 0) {
                        return '用户名2不能为空';
                    }
                    if (!urnamePattern.test(value)) {
                        return '用户名2需为2-10个字符';
                    }
                }
            },
            password2: function (value) {
                // 判断当前选中的角色 不为用户则验证
                if ($('#role').val() != '0') {
                    if (value.length == 0) {
                        return '密码2不能为空';
                    }
                    if (!pwdPattern.test(value)) {
                        return '密码2需为6-12个字符';
                    }
                }
            },
            qrpassword2: function (value) {
                // 判断当前选中的角色 不为用户则验证
                if ($('#role').val() != '0') {
                    if (value != $('#password2').val()) {
                        return '两次密码2要保持一致';
                    }
                }
            },
            email2:function (value) {
                // 判断当前选中的角色 不为用户则验证
                if ($('#role').val() != '0') {
                    // 保证邮箱不为空的时候，要满足邮箱的正则表达式
                    if (value.length != 0 && !emailPattern.test(value)) {
                        return '请输入一个合法的邮箱';
                    }
                }
            }

        })

        // 表单提交
        form.on('submit(registerForm)', function (data) {
            // console.log('成功提交注册表单')
            // console.log(JSON.stringify(data.field))
            $.ajax({
                type: "POST",
                url: "/checkRegister",  //路径
                data: data.field,
                success: function (data) {
                    if (data == 0) {
                        layer.alert('用户的用户名已存在');
                    }
                    if (data == 1) {
                        layer.alert('成功注册用户', function () {
                            window.location = '/login'
                        });
                    }
                    if (data == 2) {
                        layer.alert('审稿人的用户名已存在');
                    }
                    if (data == 3) {
                        layer.alert('成功注册审稿人', function () {
                            window.location = '/login'
                        });

                    }
                    if (data == 4) {
                        layer.alert('会议发布者的用户名已存在');
                    }
                    if (data == 5) {
                        layer.alert('成功注册会议发布者', function () {
                            window.location = '/login'
                        });
                    }
                }
            })
            return false;
        })

        // 显示对应位置的div
        function ShowDiv(num) {
            el = document.getElementsByClassName('div')
            // console.log(el)
            for (let i = 0; i < 2; i++) {
                el[i].style.display = 'none';
                // 给隐藏的元素 lay-verify 属性置空，如：lay-verify=""；
                // 取消所有的表单验证
                // form.verify();
                // $("#formDemo").validate().resetForm(); //取消form验证
                // 修改button的类型
                // $("#registerBtn").type='button';
            }
            if (num != '') {
                if (num == 2 || num == 1) {
                    document.getElementById('div1').style.display = 'block';
                    // $("#registerBtn").type='submit';
                    // 给第二个div设置表单验证
                    // form.verify({
                    //         role: function (value) {
                    //             if (value.length == 0) {
                    //                 return '请选择一个角色';
                    //             }
                    //         },
                    //         username2: function (value) {
                    //             if (value.length == 0) {
                    //                 return '用户名2不能为空';
                    //             }
                    //             if (!urnamePattern.test(value)) {
                    //                 return '用户名2需为2-10个字符';
                    //             }
                    //         },
                    //         password2:function (value) {
                    //             if (value.length == 0) {
                    //                 return '密码2不能为空';
                    //             }
                    //             if (!pwdPattern.test(value)) {
                    //                 return '密码2需为6-12个字符';
                    //             }
                    //         },
                    //         qrpassword2:function (value){
                    //             if (value != $('#password2').val()) {
                    //                 return '两次密码2要保持一致';
                    //             }
                    //         }
                    //     })
                } else {
                    document.getElementById('div' + num).style.display = 'block';
                    // $("#registerBtn").type='submit';
                    // 给第一个div设置表单验证
                    // 取消第二个div的表单验证

                    // form.verify({
                    //         role: function (value) {
                    //             if (value.length == 0) {
                    //                 return '请选择一个角色';
                    //             }
                    //         },
                    //         username: function (value) {
                    //             if (value.length == 0) {
                    //                 return '用户名不能为空';
                    //             }
                    //             if (!urnamePattern.test(value)) {
                    //                 return '用户名需为2-10个字符';
                    //             }
                    //         },
                    //         password: function (value) {
                    //             if (value.length == 0) {
                    //                 return '密码不能为空';
                    //             }
                    //             if (!pwdPattern.test(value)) {
                    //                 return '密码需为6-12个字符';
                    //             }
                    //         },
                    //         qrpassword: function (value) {
                    //             if (value != $('#password').val()) {
                    //                 return '两次密码要保持一致';
                    //             }
                    //         },
                    //     })
                }
            }

        }


    });


</script>
</body>
</html>